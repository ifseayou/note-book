# 流批一体调研

主要参考站点：https://flink-learning.org.cn/ 



## 1 美团

实时计算的主要应用场景是解决离线数仓时效性低的问题，数仓的实时部分主要通过` Flink DataStream API` 来开发，门槛比较高，而且与离线数仓的开发方式相比较为割裂，为降低开发门槛，实时数仓应该依托于FlinkSQL



场景 1 是基于 FlinkSQL + OLAP 的实时生产链路，业务会使用 FlinkSQL 来清洗和关联 ODS 层的数据，生成实时数仓的主题宽表，最后写入 OLAP 查询引擎做实时分析。对于时效性要求不高的场景，部分业务还会在 OLAP 引擎上配置分钟级别的调度来减少相同查询的压力。

场景 2 与场景 1 的不同点在于，业务实时数仓的主题宽表数据并不是直接写入 OLAP 查询引擎，而是继续写入 Kafka，使用 FlinkSQL 做 APP 层的指标聚合，最终把预计算的指标数据写入 OLAP、DB 或 KV 这类应用层的存储。这种方式更适合对接数据服务，因为它兼顾了数据的时效性和高 QPS 的查询



双流关联的大状态问题，FlinkSQL 的双流关联会保留左右流的历史数据来互相关联，需要关联的时间间隔越长，保存的历史数据就会越多，状态也就会越大。比如，要关联订单的下单事件和退款事件，并保证计算结果的正确性，需要考虑这两个事件发生的间隔，可能是一个月甚至更久

对于上述问题，我们提出了冷热关联分离的解决方案。假设关联两天前的数据是相对低频的且状态回滚不会超过两天，那么可以定义两天前的数据为冷数据，两天之内的数据为热数据



另外描述的3个问题：

* SQL 变更状态恢复问题

* FlinkSQL 调试繁琐问题

* SQL 作业异常定位问题

详细见美团流批一体实践[^1]



## 2，京东

提到流批一体，不得不提传统的大数据平台 —— Lambda 架构。它能够有效地支撑离线和实时的数据开发需求，但它流和批两条数据链路割裂所导致的高开发维护成本以及数据口径不一致是无法忽视的缺陷

通过一套数据链路来同时满足流和批的数据处理需求是最理想的情况，即流批一体。此外我们认为流批一体还存在一些中间阶段，比如只实现计算的统一或者只实现存储的统一也是有重大意义的



## 3，小米

2021 年，开始接入数据湖 Iceberg，基于 Flink 和 Iceberg 来构建流批一体的实时数仓解决方案





[^1]: 美团：https://flink-learning.org.cn/article/detail/ad438be7df7e0d4509df8b04fd06c68a
[^3]:小米：https://flink-learning.org.cn/article/detail/58e70ce6b228946ceca2e09582ba8e18?name=author&tab=3a7088dd6f5f1ef95770aa10203985fa&page=xiangguanwenzhang